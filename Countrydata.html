<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
     "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eco TurningPoint</title>
      <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hover.css/2.3.1/css/hover-min.css" integrity="sha512-csw0Ma4oXCAgd/d4nTcpoEoz4nYvvnk21a8VA2h2dzhPAvjbUIK6V3si7/g/HehwdunqqW18RwCJKpD7rL67Xg==" crossorigin="anonymous" />


        <!-- Fonts -->
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200;400;500;600&family=Roboto:wght@400;500;700&family=Titillium+Web:ital,wght@0,400;0,600;1,300;1,400&display=swap" rel="stylesheet">
<!--- Font Awesome-->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.1/css/all.css" integrity="sha384-vp86vTRFVJgpjF9jiIGPEEqYqlDwgyBgEF109VFjmqGmIY/Y4HV4d3Gp2irVfcrp" crossorigin="anonymous">
      

<!--styling-->    
     <link rel="stylesheet" href="assets/css/style.css" type="text/css"/>

</head>
<body id="CountrydataPage">

    <header>
        <div class="container text-center">
    <div class="logo"> <p>Eco Turning-Point</p></div>
    <div class="nav">
        <ul class="list-inline">
            <li class="list-inline-item"> <a href="index.html">Home</a></li>
            <li class="list-inline-item"> <a href="Countrydata.html">Info/Country</a></li>
            <li class="list-inline-item"><a href="temporary.html"> Take Action</a></li>
        </ul>
    </div>
    </div>
    </header>
<section class="text-center" id="country_main">
    <div class="country_mainframe container">
        <div class="row">
            <div class="col-12 text-center Title"><p> World map with information on country level</p></div>
            <div class="col-12 country_main text-center" id="country_main_right">
                <div id="map"></div>
            </div>
              </div>
    </div>
    <div class="container country_factsframe">
        <div class="country_factsmain">
        </div>
    </div>
</section>
<footer>
<div class="footerframe container">
    <div class="row">
    <div class="col-4 text-center">
        <h1>About</h1>
        <p> Sfsd fs f dsgdgaedgecxv esatgaedrgae
            sdfsdfsdgfasdg sd
            asdgasdgdgadfgzdafgadfgadfggd
        </p>
    </div>
    <div class="col-4 text-center">    
          <h1>Quick Links</h1>
             <ul>
            <li href="index.html">Home</li>
            <li href="Countrydata.html">Info/Country</li>
            <li>Take Action</li>
        </ul>
    </div>
    <div class="col-4 text-center">
               <h1 class="text-center">Contact Us</h1>
             <ul>
            <li>Twitter</li>
            <li>Facebook</li>
            <li>Instagram</li>
        </ul>
    </div>
</div>
</div>
</footer>
<script type="text/javascript">  


 let pushstep1=[];
let pushstep2=[];
let pushstep3=[];
let pushstep4=[];
let locations=[];

let countries, pop 

fetch("https://www.trackcorona.live/api/countries")
.then(function (response) {
    return response.json();
    })
.then(function (dataCountry) {
    countries = dataCountry;
    return fetch ('https://api.worldbank.org/v2/country/all/indicator/SP.POP.TOTL/?format=json&date=2010:2020&per_page=5000')
})
.then(function (response) {
    return response.json();
    })
    
.then(function (dataPop) {
        pop = dataPop;

      // console.log(pop);
       //console.log(countries.data[1].location)
        let length = pop[1].length;
        let len = countries.data.length;
        i=0;
        e=0;

           for (i = 0; i < length; i++){
             for (e = 0; e < len; e++ ) {
        if (pop[1][i].country.value === countries.data[e].location){
        if (pop[1][i].date === "2018"){
        pushstep1.push({"country":countries.data[e].location, "lat":countries.data[e].latitude, "long":countries.data[e].longitude,"pop":(pop[1][i].value/1000000).toFixed(2)});
        }
        }
       }
        }
        
     //console.log(pushstep1);
    })
    .then(function (dataCountry) {
    countries = dataCountry;
    return fetch ('https://api.worldbank.org/v2/en/country/all/indicator/SP.DYN.LE00.IN?format=json&per_page=3000&source=2&date=2010:2020')
    })
    .then(function (response) {
    return response.json();
    })
    
    .then(function (dataAge) {
        age = dataAge;

           let length = age[1].length;
        let lngth = pushstep1.length;
        i=0;
        c=0;

           for (i = 0; i < length; i++){
             for (c = 0; c < lngth; c++ ) {
        if (age[1][i].country.value === pushstep1[c].country){
        if (age[1][i].date === "2018"){
        pushstep2.push({"country":pushstep1[c].country, "lat":pushstep1[c].lat, "long":pushstep1[c].long,"pop":pushstep1[c].pop, "lifeexp":age[1][i].value});
        }
        }
       }
        }
        
   //  console.log(pushstep2);
    
    })
    .then(function (dataPov) {
    poverty = dataPov;
    return fetch ('https://api.worldbank.org/v2/en/country/all/indicator/SI.POV.DDAY?format=json&per_page=3000&source=2&date=2010:2020')
})
.then(function (response) {
    return response.json();
    })
    
.then(function (datapoverty) {
        povert = datapoverty;

      console.log(povert);
       //console.log(countries.data[1].location)
        let length = povert[1].length;
         let lngth2 = pushstep2.length;
        i=0;
        c=0;

         for (i = 0; i < length; i++){
             for (c = 0; c < lngth2; c++ ) {
        if (povert[1][i].country.value === pushstep2[c].country){
        if (povert[1][i].date === "2018"){
        pushstep3.push({"country":pushstep1[c].country, "lat":pushstep1[c].lat, "long":pushstep1[c].long,"pop":pushstep1[c].pop, "lifeexp":age[1][i].value, "poverty": povert[1][i].value});
         }
        }
       }
    }
    // console.log(pushstep3);
        })
         .then(function (dataCO2) {
    dCO2 = dataCO2;
    return fetch ('https://api.worldbank.org/v2/en/country/all/indicator/EN.ATM.CO2E.KT?format=json&per_page=20000&source=2')
})
.then(function (response) {
    return response.json();
    })
    
.then(function (dataco2) {
        CO2 = dataco2;

      console.log(CO2);
       //console.log(countries.data[1].location)
        let length = CO2[1].length;
         let lngth3 = pushstep3.length;
        i=0;
        c=0;

         for (i = 0; i < length; i++){
             for (c = 0; c < lngth3; c++ ) {
        if (CO2[1][i].country.value === pushstep3[c].country){
        if (CO2[1][i].date === "2016"){
       locations.push({"country":pushstep3[c].country, "lat":pushstep3[c].lat, "long":pushstep3[c].long,"pop":pushstep3[c].pop, "lifeexp":pushstep3[c].lifeexp, "poverty": pushstep3[c].poverty, "CO2":CO2[1][i].value });
         }
        }
       }
    }
     //console.log(locations);
        })
  .then(
 function initMap() {
  const map = new google.maps.Map(document.getElementById("map"), {
    zoom: 2,
    minZoom:2,
    center: { lat: 20, lng: 0 },
   styles:  [
      {
        featureType: "all",
        elementType: "geometry.fill",
        stylers: [{ color: "#b6af95" }],
   }, 
   {
        featureType: "administrative.locality",
        elementType: "geometry.fill",
        stylers: [{ color: "#b6af95" }],
   },
       {
        featureType: "water",
        elementType: "geometry.fill",
        stylers: [{ color: "#2a4966" }],
   },{
        featureType: "administrative.land_parcel",
        elementType: "geometry.fill",
        stylers: [{ color: "#a8aaa8" }]},
        {
        featureType: "landscape.natural.landcover",
        elementType: "geometry.fill",
        stylers: [{ color: "#bebdb3" }]}
        ,{
        featureType: "administrative.land_parcel",
        elementType: "geometry.fill",
        stylers: [{ color: "#a8aaa8" }]},
        {
        featureType: "landscape.natural.terrain",
        elementType: "geometry.fill",
        stylers: [{ color: "#b6ad8d" }]},
          {
        featureType: "landscape.man_made",
        elementType: "geometry.fill",
        stylers: [{ color: "#575149" }]},
         {
        featureType: "poi.park",
        elementType: "geometry.fill",
        stylers: [{ color: "#bacf7a" }]},
         {
        featureType: "road",
        elementType: "geometry.fill",
        stylers: [{ color: "#562b07" }]},
          {
        featureType: "transit",
        elementType: "geometry.fill",
        stylers: [{ color: "#d98910" }]},
        

  ]})
 var infowindow = new google.maps.InfoWindow;


 var marker, a;

 const image = {
    url: "assets/img/map-pin-solid.svg",
       scaledSize: new google.maps.Size(27, 27),
    
   };




    for (a = 0; a < locations.length; a++) {  
           marker = new google.maps.Marker({
                         position: new google.maps.LatLng(locations[a].lat, locations[a].long),
             map: map,
             icon: image,
                    })

    

      google.maps.event.addListener(marker, 'click', (function(marker, a, image) {
             return function() {
                 infowindow.setContent('<div class="map-info-window">'+ '<h1>'+ locations[a].country + '<h1>'+'<p>' + 'Population: ' + locations[a].pop + ' million ' +'</p>' + '<p>' + 'Life Expectancy: ' + locations[a].lifeexp + '<p>' + 'Living on under 1.9$/day: ' + locations[a].poverty + ' %'  +'</p>' + '<p>' + ' Annual CO2-emission: ' + locations[a].CO2 + ' Kilo tonnes ' + '</div>');
                 infowindow.open(map, marker);
             }
        })(marker, a))
    } 
   
})      

 //locations.push({"country":pushstep3[c].country, "lat":pushstep3[c].lat, "long":pushstep3[c].long,"pop":pushstep3[c].pop, "lifeexp":pushstep3[c].lifeexp, "poverty": pushstep3[c].poverty, "CO2":CO2[1][i].value });
 .catch(function (error) {
		// if there's an error, log it
		console.log(error);
    }
);


</script>
<script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js"></script>
 <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCzcqy8wuUG_M_fC8xcJt7eRV0aqD4-Un4&callback=initMap"></script>
</body>
</html>